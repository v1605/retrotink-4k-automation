# Node-Red

In this folder you will find an example flow that will open the profile menu and navigate it to a custom profile, then closes the menu. The two javascript files are the functions used to parse the mapping generated by sdcardMapping script and to perform the needed clicks. The screenshot on the main README is this flow.

## Modifications to Use This Flow
1. Replace the button entities with ones that match your esphome device.
2. Edit script delays and the delays within the function if required. These times work in my setup, but depening on your network you may need to increase them.

## Auto-Switching via Mister Remote Script
If you are using [Wizzo's Remote Script](https://github.com/wizzomafizzo/mrext?tab=readme-ov-file#remote) and the [Last Played Script](https://github.com/wizzomafizzo/mrext?tab=readme-ov-file#lastplayed). You can use a homeassistant webhook to trigger an automation, like switching to a custom profile based on the core and/or game loaded.

**Setup Node-Red**
1. Create a "Webhook" node in a workflow.
2. Open the panel for the node and press the copy button next to the webhook id to get your url.
3. Replace the '<ip>:<port>' section with your homeassistant's information.

**Setup Mister**
1. Install the remote and last played extensions. Enable both.
2. Create a file in the Misters "scripts" folder named "remote.ini"
3. Paste the contents below into the file, replacing the url with the one you created in node-red
```
[remote]
announce_game_url=https://mydomain.homeassistant.com/api/webhook/Zr5pf5d2NPTLh4RvLTZI4QgkZ25uDn9R
```

**Example Payload**
```
{
    "core": "GBA",
    "gameFilename": "Pokemon - Sapphire Version (USA, Europe) (Rev 2).gba",
    "gameName": "Pokemon - Sapphire Version (USA, Europe) (Rev 2)",
    "gamePath": "/media/fat/games/GBA/1 USA - P-S/Pokemon - Sapphire Version (USA, Europe) (Rev 2).gba",
    "hostname": "MiSTer",
    "platform": "MiSTer",
    "system": "GBA",
    "systemName": "Gameboy Advance"
}
```
